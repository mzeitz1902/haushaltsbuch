import{G as a,K as h,O as d,ac as C,bc as v,cc as w,dc as m,f as E,fc as _,hc as b,ic as I,jc as g,kc as x,lc as F,m as y,mc as P,nc as k,oc as p,r as u,yb as H}from"./chunk-7CABNVJA.js";var c=b({source:"Weekly Check",events:{load:void 0,loadSuccess:void 0,setCurrentHistoryInformation:void 0,addHistoryEntry:void 0,addHistoryEntrySuccess:void 0,deleteHistoryEntry:void 0,deleteHistoryEntrySuccess:void 0,updateHistoryEntry:void 0,updateHistoryEntrySuccess:void 0,createWeek:void 0,createWeekSuccess:void 0}}),t={load:c.load,loadSuccess:c.loadSuccess,setCurrentHistoryInformation:c.setCurrentHistoryInformation,addHistoryEntry:c.addHistoryEntry,addHistoryEntrySuccess:c.addHistoryEntrySuccess,deleteHistoryEntry:c.deleteHistoryEntry,deleteHistoryEntrySuccess:c.deleteHistoryEntrySuccess,updateHistoryEntry:c.updateHistoryEntry,updateHistoryEntrySuccess:c.updateHistoryEntrySuccess,createWeek:c.createWeek,createWeekSuccess:c.createWeekSuccess};var l=class o{getWeeklyChecks(){return y(k.from("weekly_check").select("*").order("id")).pipe(u(e=>e.data??null))}addHistoryEntry(e,r){return y(k.rpc("append_weekly_check_history",{p_weekly_check_id:e,p_shop_column:r}))}deleteHistoryEntry(e,r,i){return y(k.rpc("delete_weekly_check_history",{p_history_id:r,p_shop:i,p_weekly_check_id:e}))}updateHistoryEntry(e,r,{id:i,value:s,note:n}){return y(k.rpc("update_weekly_check_history",{p_weekly_check_id:e,p_shop:r,p_history_id:i,p_new_value:s,p_new_note:n}))}createWeek(){return y(k.rpc("insert_next_weekly_check"))}static \u0275fac=function(r){return new(r||o)};static \u0275prov=h({token:o,factory:o.\u0275fac})};function j(o,e=d(_),r=d(l)){function i(){return E(u(s=>{let n=C(o);return{weeklyCheckId:n.currentWeekId,shop:n.currentShop,payload:s.payload}}))}return{load$:e.on(t.load,t.addHistoryEntrySuccess,t.deleteHistoryEntrySuccess,t.updateHistoryEntrySuccess,t.createWeekSuccess).pipe(a(()=>r.getWeeklyChecks().pipe(p({next:s=>t.loadSuccess(s),error:console.error})))),addHistoryEntry$:e.on(t.addHistoryEntry).pipe(i(),a(({weeklyCheckId:s,shop:n})=>r.addHistoryEntry(s,n).pipe(p({next:()=>t.addHistoryEntrySuccess(),error:console.error})))),deleteHistoryEntry$:e.on(t.deleteHistoryEntry).pipe(i(),a(({weeklyCheckId:s,shop:n,payload:W})=>r.deleteHistoryEntry(s,W,n).pipe(p({next:()=>t.deleteHistoryEntrySuccess(),error:console.error})))),updateHistoryEntry$:e.on(t.updateHistoryEntry).pipe(i(),a(({weeklyCheckId:s,shop:n,payload:W})=>r.updateHistoryEntry(s,n,W).pipe(p({next:()=>t.updateHistoryEntrySuccess(),error:console.error})))),createWeek$:e.on(t.createWeek).pipe(a(()=>r.createWeek().pipe(p({next:()=>t.createWeekSuccess(),error:console.error}))))}}var f=v(F("weekly-check",x()),w({weeklyChecks:[],loadProcessStatus:"init",currentWeekId:null,currentShop:null}),g(o=>j(o)),P(m(t.load,()=>({loadProcessStatus:"pending"})),m(t.loadSuccess,({payload:o},e)=>o?{weeklyChecks:o,loadProcessStatus:"success"}:e),m(t.setCurrentHistoryInformation,({payload:{weeklyCheckId:o,shop:e}})=>({currentWeekId:o,currentShop:e}))));var S=class o{events=I(t);store=d(f);loadProcessStatus=this.store.loadProcessStatus;weeklyChecks=this.store.weeklyChecks;currentWeekId=this.store.currentWeekId;currentShop=this.store.currentShop;isLoading=H(()=>this.loadProcessStatus()==="pending");currentHistory=H(()=>{let e=this.weeklyChecks().find(r=>r.id===this.currentWeekId());return!e||!this.currentShop()?null:e[this.currentShop()].history});loadWeeklyChecks(){this.events.load()}setCurrentHistoryInformation(e,r){this.events.setCurrentHistoryInformation({weeklyCheckId:e,shop:r})}addHistoryEntry(){this.events.addHistoryEntry()}deleteHistoryEntry(e){return this.events.deleteHistoryEntry(e)}updateHistoryEntry(e){this.events.updateHistoryEntry(e)}createWeek(){this.events.createWeek()}static \u0275fac=function(r){return new(r||o)};static \u0275prov=h({token:o,factory:o.\u0275fac})};function de(){return[l,S,f]}export{S as a,de as b};
