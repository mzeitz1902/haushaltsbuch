import{a as $}from"./chunk-7H4QHFOD.js";import{a as Ee,b as We,c as Me}from"./chunk-U632WCMZ.js";import{$a as S,A as te,Aa as ae,Ad as we,Ba as se,Bd as ve,Cb as W,Cd as O,Da as M,Db as ke,Ea as I,Eb as B,Fa as v,Fd as Q,Ga as s,Gd as j,Ha as l,Hd as J,I as ne,Ia as V,Ja as A,Ka as K,La as ce,O as C,Ob as fe,Pa as E,Q as p,Qa as pe,Qb as b,R as m,Ra as y,Sa as me,Sd as be,Ta as d,Td as xe,Z as x,ab as D,bb as T,cb as de,d as ee,db as u,ea as ie,fa as o,fb as P,gb as c,hb as U,ib as f,jb as ue,ka as re,la as w,ra as oe,rb as k,rc as he,sb as h,tb as G,ua as z,wc as _e,xa as H,xd as q,ya as N,yb as _,yc as ge,yd as Ce,za as le,zb as ye}from"./chunk-NZRAOUAS.js";var Ie=ee(he());var De=["noteInput"],Te=["valueInput"],Fe=(r,t)=>t.id;function He(r,t){if(r&1){let e=E();s(0,"div",8)(1,"span",9),y("click",function(){let i=p(e).$implicit,a=d();return m(a.edit(i,"note"))}),c(2),l(),s(3,"span",10),y("click",function(){let i=p(e).$implicit,a=d();return m(a.edit(i,"value"))}),c(4),k(5,"currency"),l(),s(6,"input",11,0),y("click",function(){p(e);let i=T(7);return m(i.select())})("blur",function(){p(e);let i=d();return m(i.submit())})("keyup.enter",function(){p(e);let i=d();return i.submit(),m(i.reset())}),l(),H(),s(8,"input",12,1),y("click",function(){p(e);let i=T(9);return m(i.select())})("blur",function(){p(e);let i=d();return m(i.submit())})("keyup.enter",function(){p(e);let i=d();return i.submit(),m(i.reset())}),l(),H(),s(10,"button",13),y("click",function(){let i=p(e).$implicit,a=d();return m(a.deleteEntry(i.id))}),l()()}if(r&2){let e=t.$implicit,n=t.$index,i=t.$count,a=d(),g="ml-2 my-2 p-4";u("border-b-gray-50",n!==i-1)("border-b",n!==i-1),o(),P(g),u("hidden",a.selectedEntry()===e.id),o(),f(" ",e.note," "),o(),P(g),u("hidden",a.selectedEntry()===e.id),o(),f(" ",h(5,28,e.value)," "),o(2),P(g),u("hidden",a.selectedEntry()!==e.id),z("data-id",e.id),N(a.form.note,"formField"),o(2),P(g),u("hidden",a.selectedEntry()!==e.id),z("data-id",e.id),N(a.form.value,"formField")}}function Ne(r,t){r&1&&(s(0,"div",6),c(1,"Noch keine Eintr\xE4ge vorhanden."),l())}var L=class r{facade=C($);history=this.facade.currentHistory;data=C(be);noteInputs=B("noteInput");valueInputs=B("valueInput");selectedEntry=x(null);formModel=x(this.initForm());form=Q(this.formModel,t=>{J(t.id),J(t.value)});constructor(){this.facade.setCurrentHistoryInformation(this.data.weeklyCheckId,this.data.shop)}deleteEntry(t){return this.facade.deleteHistoryEntry(t)}addEntry(){this.facade.addHistoryEntry()}edit(t,e){this.selectedEntry.set(t.id),this.formModel.set({id:t.id,value:t.value,note:t.note}),setTimeout(()=>{let n=this.selectedEntry();if(n)switch(e){case"note":{this.noteInputs().find(a=>a.nativeElement.dataset.id===n).nativeElement.select();break}case"value":{this.valueInputs().find(a=>a.nativeElement.dataset.id===n).nativeElement.select();break}}})}submit(){if(this.form().valid()){this.facade.updateHistoryEntry(this.formModel());return}}reset(){this.selectedEntry.set(null),this.formModel.set(this.initForm())}initForm(){return{id:null,value:null,note:null}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-weekly-history"]],viewQuery:function(e,n){e&1&&S(n.noteInputs,De,5)(n.valueInputs,Te,5),e&2&&D(2)},decls:8,vars:1,consts:[["noteInput",""],["valueInput",""],[1,"flex","flex-col","gap-2","overflow-hidden","pb-2"],[1,"max-h-64","overflow-auto"],[1,"flex","w-full","flex-col","items-center","justify-center","**:text-white"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2",3,"border-b-gray-50","border-b"],[1,"p-2"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2"],[3,"click"],[1,"m-0!","my-0!","w-full","text-right",3,"click"],[1,"w-full","rounded","border","border-blue-400","bg-gray-600","outline-none",3,"click","blur","keyup.enter","formField"],["type","number",1,"w-full","rounded","border","border-blue-400","bg-gray-600","text-right","outline-none",3,"click","blur","keyup.enter","formField"],["maffiButton","","icon","Trash",1,"mr-2",3,"click"]],template:function(e,n){e&1&&(s(0,"section",2)(1,"div",3)(2,"div",4),M(3,He,11,30,"div",5,Fe,!1,Ne,2,0,"div",6),l()(),s(6,"button",7),y("click",function(){return n.addEntry()}),c(7," Hinzuf\xFCgen "),l()()),e&2&&(o(3),I(n.history()))},dependencies:[q,j,b],encapsulation:2})};var R=class r{bottomSheet=C(xe);viewContainerRef=C(re);weeklyCheckId=W.required();label=W.required();entry=W.required();shop=W.required();isOpened=x(!1);iconPath=_(()=>`assets/${this.shop()}.svg`);openBottomSheet(){this.isOpened.set(!0);let t={weeklyCheckId:this.weeklyCheckId(),shop:this.shop()};this.bottomSheet.open(L,{data:t,viewContainerRef:this.viewContainerRef}).afterDismissed().pipe(te(1),ne(()=>this.isOpened.set(!1))).subscribe()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-weekly-check-shop"]],inputs:{weeklyCheckId:[1,"weeklyCheckId"],label:[1,"label"],entry:[1,"entry"],shop:[1,"shop"]},decls:8,vars:9,consts:[[1,"flex","cursor-pointer","items-center","gap-2","rounded-lg","p-1","hover:bg-gray-600","focus:bg-gray-600",3,"click"],["alt","icon",1,"h-7","w-7","object-contain",3,"src"],[1,"flex","min-w-0","flex-col","gap-1"],[1,"text-xs"],[1,"text-sm"]],template:function(e,n){e&1&&(A(0,"div",0),me("click",function(){return n.openBottomSheet()}),ce(1,"img",1),A(2,"div",2)(3,"span",3),c(4),K(),A(5,"span",4),c(6),k(7,"currency"),K()()()),e&2&&(u("bg-gray-600",n.isOpened())("bg-gray-700",!n.isOpened()),o(),pe("src",n.iconPath(),ie),o(3),U(n.label()),o(2),U(h(7,7,n.entry().value)))},dependencies:[b],encapsulation:2})};function Ve(r,t){if(r&1&&V(0,"app-weekly-check-shop",13),r&2){let e=t.$implicit,n=d();u("*:bg-gray-600",n.isCurrent())("*:hover:bg-gray-500",n.isCurrent()),v("weeklyCheckId",n.week().id)("label",e.label)("entry",e.entry)("shop",e.shop)}}var F=class r{week=W.required();item=ke.required(O);entries=_(()=>{let t=this.week();return[{label:"Lidl",entry:t.lidl,shop:"lidl"},{label:"Drogerie",entry:t.drugstore,shop:"drugstore"},{label:"Edeka",entry:t.edeka,shop:"edeka"},{label:"Sonstige",entry:t.misc,shop:"misc"},{label:"Kaufland",entry:t.kaufland,shop:"kaufland"},{label:"Ausw\xE4rts",entry:t.away,shop:"away"},{label:"B\xE4cker / Fleischer",entry:t.baker_butcher,shop:"baker_butcher"}]});isCurrent=_(()=>{let t=this.week(),e=(0,Ie.default)().week();return t.cw===e});static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-week"]],viewQuery:function(e,n){e&1&&S(n.item,O,5),e&2&&D()},inputs:{week:[1,"week"]},decls:25,vars:29,consts:[["accItem","cdkAccordionItem"],[1,"cursor-pointer"],[3,"expanded"],[1,"grid","w-full","grid-cols-[5rem_1fr_1.5rem]","gap-2",3,"click"],[1,"flex","items-center","gap-4"],[1,"flex","flex-col","gap-2"],[1,"font-semibold"],[1,"text-(length:--text-xs)","font-medium"],[1,"text-right"],["size","small",1,"ml-1",3,"icon"],[1,"overflow-hidden","pt-4","transition-[max-height]","duration-300","ease-in-out"],[1,"grid","grid-cols-3","gap-2"],[3,"*:bg-gray-600","*:hover:bg-gray-500","weeklyCheckId","label","entry","shop"],[3,"weeklyCheckId","label","entry","shop"]],template:function(e,n){if(e&1){let i=E();s(0,"mat-card",1)(1,"mat-card-content")(2,"cdk-accordion-item",2,0)(4,"header",3),y("click",function(){p(i);let g=T(3);return m(g.toggle())}),s(5,"div",4)(6,"div",5)(7,"h2",6),c(8),l(),s(9,"h1",7),c(10),k(11,"date"),k(12,"date"),l()()(),s(13,"div",5)(14,"span",8),c(15),k(16,"currency"),l(),s(17,"span",8),c(18),k(19,"currency"),l()(),V(20,"app-icon",9),l(),s(21,"div",10)(22,"div",11),M(23,Ve,1,8,"app-weekly-check-shop",12,se),l()()()()()}if(e&2){let i=T(3);u("bg-gray-700!",n.isCurrent()),o(2),v("expanded",n.isCurrent()),o(6),f("KW ",n.week().cw),o(2),ue(" ",G(11,19,n.week().dateFrom,"dd.MM.")," - ",G(12,22,n.week().dateTo,"dd.MM.")," ");let a=n.week().total,g=250-a;o(4),u("text-green-500",a<=250)("text-red-500",a>250),o(),f(" ",h(16,25,a)," "),o(2),u("text-green-500",a<=250)("text-red-500",a>250),o(),f(" ",h(19,27,g)," "),o(2),v("icon",i.expanded?"ChevronUp":"ChevronDown"),o(),de("max-height",i.expanded?"1000px":"0px"),o(2),I(n.entries())}},dependencies:[_e,ge,O,Ce,R,fe,b],encapsulation:2})};var Y=ee(he());var Pe=(r,t)=>t.id;function Be(r,t){if(r&1&&c(0),r&2){let e=t.item,n=d();f(" ",n.format(e).format("MMMM")," ")}}function Ae(r,t){if(r&1){let e=E();s(0,"span",9),y("click",function(){p(e);let i=d();return m(i.expandAll())}),c(1," Alle ausklappen "),l()}}function $e(r,t){if(r&1){let e=E();s(0,"span",9),y("click",function(){p(e);let i=d();return m(i.collapseAll())}),c(1," Alle einklappen "),l()}}function qe(r,t){if(r&1&&V(0,"app-week",7),r&2){let e=t.$implicit;v("week",e)}}function Oe(r,t){r&1&&c(0," Noch keine Wochen angelegt ")}var Se=class r{facade=C($);weeks=this.facade.weeklyChecks;isLoading=this.facade.isLoading;items=B(F);state=x("closed");currentMonth=_(()=>{let t=(0,Y.default)().week();if(this.weeks().length!==0)return this.weeks().find(e=>e.cw===t).month});filteredWeeks=_(()=>this.weeks().filter(t=>t.month===this.formModel().month));totalBudget=_(()=>this.filteredWeeks().length*250);totalSpent=_(()=>this.filteredWeeks().reduce((t,e)=>t+e.total,0));formModel=ye(()=>({month:this.currentMonth()??null}));form=Q(this.formModel);constructor(){this.facade.loadWeeklyChecks()}expandAll(){this.items()?.forEach(t=>t.item().open()),this.state.set("open")}collapseAll(){this.items()?.forEach(t=>t.item().close()),this.state.set("closed")}createWeek(){this.facade.createWeek()}months=Array.from({length:12},(t,e)=>(0,Y.default)().month(e).format("YYYY-MM-01"));format=Y.default;static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-weekly-check"]],viewQuery:function(e,n){e&1&&S(n.items,F,5),e&2&&D()},hostAttrs:[1,"flex","flex-col"],decls:18,vars:17,consts:[["title","Wochencheck"],[1,"w-40",3,"items","clearable","formField"],["ng-label-tmp","","ng-option-tmp",""],[1,"container-max-sm","flex","items-center","justify-between","px-4","pt-2"],[1,"flex","items-center","gap-2"],[1,"cursor-pointer","text-sm"],[1,"container-max-sm","flex","w-full","flex-col","items-center","gap-2","p-2","*:w-full","md:p-6",3,"multi"],[3,"week"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"cursor-pointer","text-sm",3,"click"]],template:function(e,n){if(e&1&&(s(0,"app-header",0)(1,"ng-select",1),oe(2,Be,1,1,"ng-template",2),l(),H(),l(),s(3,"header",3)(4,"span",4),c(5),k(6,"currency"),s(7,"span"),c(8),k(9,"currency"),l()(),le(10,Ae,2,0,"span",5)(11,$e,2,0,"span",5),l(),s(12,"cdk-accordion",6),M(13,qe,1,1,"app-week",7,Pe,!1,Oe,1,0),l(),s(16,"button",8),y("click",function(){return n.createWeek()}),c(17,` Neue Woche anlegen
`),l()),e&2){let i;o(),v("items",n.months)("clearable",!1),N(n.form.month,"formField"),o(4),f(" ",h(6,13,n.totalBudget())," | "),o(2),u("text-green-500",n.totalSpent()<=n.totalBudget())("text-red-500",n.totalSpent()>n.totalBudget()),o(),f(" ",h(9,15,n.totalSpent())," "),o(2),ae((i=n.state())==="closed"?10:i==="open"?11:-1),o(2),v("multi",!0),o(),I(n.filteredWeeks())}},dependencies:[we,F,ve,Me,j,q,We,Ee,b],encapsulation:2})};export{Se as WeeklyCheckComponent};
