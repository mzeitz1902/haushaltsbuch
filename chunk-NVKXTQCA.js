import{a as O}from"./chunk-T2BBXKCG.js";import{a as De,b as Te,c as Fe}from"./chunk-CD6YGOLK.js";import{$a as S,A as le,Aa as me,Ad as Me,Ba as ue,Bd as j,Cb as W,Da as M,Db as Ce,Ea as I,Eb as P,Ed as q,Fa as v,Fd as Q,Ga as s,Gd as L,Ha as a,I as ae,Ia as V,Ja as A,Ka as G,La as fe,O as C,Ob as we,Pa as E,Q as d,Qa as ye,Qb as b,R as m,Ra as y,Rd as Ie,Sa as ke,Sd as Se,Ta as u,Z as x,ab as D,bb as T,c as Oe,cb as he,d as K,db as f,ea as se,fa as o,fb as B,gb as c,hb as J,ib as h,jb as _e,ka as ce,la as w,ra as pe,rb as k,rc as ve,sb as _,tb as X,ua as U,wc as be,wd as $,xa as H,xd as Ee,ya as N,yb as g,yc as xe,za as de,zb as ge,zd as We}from"./chunk-RYODJHBK.js";var He=Oe((te,ne)=>{"use strict";(function(r,e){typeof te=="object"&&typeof ne<"u"?ne.exports=e():typeof define=="function"&&define.amd?define(e):(r=typeof globalThis<"u"?globalThis:r||self).dayjs_plugin_weekOfYear=e()})(te,function(){"use strict";var r="week",e="year";return function(t,n,i){var l=n.prototype;l.week=function(p){if(p===void 0&&(p=null),p!==null)return this.add(7*(p-this.week()),"day");var re=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var Be=i(this).startOf(e).add(1,e).date(re),Pe=i(this).endOf(r);if(Be.isBefore(Pe))return 1}var Ae=i(this).startOf(e).date(re).startOf(r).subtract(1,"millisecond"),oe=this.diff(Ae,r,!0);return oe<0?i(this).startOf("week").week():Math.ceil(oe)},l.weeks=function(p){return p===void 0&&(p=null),this.week(p)}}})});var ie=K(ve());var $e=["noteInput"],je=["valueInput"],qe=(r,e)=>e.id;function Qe(r,e){if(r&1){let t=E();s(0,"div",8)(1,"span",9),y("click",function(){let i=d(t).$implicit,l=u();return m(l.edit(i,"note"))}),c(2),a(),s(3,"span",10),y("click",function(){let i=d(t).$implicit,l=u();return m(l.edit(i,"value"))}),c(4),k(5,"currency"),a(),s(6,"input",11,0),y("click",function(){d(t);let i=T(7);return m(i.select())})("blur",function(){d(t);let i=u();return m(i.submit())})("keyup.enter",function(){d(t);let i=u();return i.submit(),m(i.reset())}),a(),H(),s(8,"input",12,1),y("click",function(){d(t);let i=T(9);return m(i.select())})("blur",function(){d(t);let i=u();return m(i.submit())})("keyup.enter",function(){d(t);let i=u();return i.submit(),m(i.reset())}),a(),H(),s(10,"button",13),y("click",function(){let i=d(t).$implicit,l=u();return m(l.deleteEntry(i.id))}),a()()}if(r&2){let t=e.$implicit,n=e.$index,i=e.$count,l=u(),p="ml-2 my-2 p-4";f("border-b-gray-50",n!==i-1)("border-b",n!==i-1),o(),B(p),f("hidden",l.selectedEntry()===t.id),o(),h(" ",t.note," "),o(),B(p),f("hidden",l.selectedEntry()===t.id),o(),h(" ",_(5,28,t.value)," "),o(2),B(p),f("hidden",l.selectedEntry()!==t.id),U("data-id",t.id),N(l.form.note,"formField"),o(2),B(p),f("hidden",l.selectedEntry()!==t.id),U("data-id",t.id),N(l.form.value,"formField")}}function Le(r,e){r&1&&(s(0,"div",6),c(1,"Noch keine Eintr\xE4ge vorhanden."),a())}var R=class r{facade=C(O);history=this.facade.currentHistory;data=C(Ie);noteInputs=P("noteInput");valueInputs=P("valueInput");selectedEntry=x(null);formModel=x(this.initForm());form=q(this.formModel,e=>{L(e.id),L(e.value),L(e.note)});constructor(){this.facade.setCurrentHistoryInformation(this.data.weeklyCheckId,this.data.shop)}deleteEntry(e){return this.facade.deleteHistoryEntry(e)}addEntry(){this.facade.addHistoryEntry()}edit(e,t){this.selectedEntry.set(e.id),this.formModel.set({id:e.id,value:e.value,note:e.note}),setTimeout(()=>{let n=this.selectedEntry();if(n)switch(t){case"note":{this.noteInputs().find(l=>l.nativeElement.dataset.id===n).nativeElement.select();break}case"value":{this.valueInputs().find(l=>l.nativeElement.dataset.id===n).nativeElement.select();break}}})}submit(){this.form().valid()&&this.facade.updateHistoryEntry(this.formModel())}reset(){this.selectedEntry.set(null),this.formModel.set(this.initForm())}initForm(){return{id:null,value:null,note:null}}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-weekly-history"]],viewQuery:function(t,n){t&1&&S(n.noteInputs,$e,5)(n.valueInputs,je,5),t&2&&D(2)},decls:8,vars:1,consts:[["noteInput",""],["valueInput",""],[1,"flex","flex-col","gap-2","overflow-hidden","pb-2"],[1,"max-h-64","overflow-auto"],[1,"flex","w-full","flex-col","items-center","justify-center","**:text-white"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2",3,"border-b-gray-50","border-b"],[1,"p-2"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2"],[3,"click"],[1,"m-0!","my-0!","w-full","text-right",3,"click"],[1,"w-full","rounded","border","border-blue-400","bg-gray-600","outline-none",3,"click","blur","keyup.enter","formField"],["type","number",1,"w-full","rounded","border","border-blue-400","bg-gray-600","text-right","outline-none",3,"click","blur","keyup.enter","formField"],["maffiButton","","icon","Trash",1,"mr-2",3,"click"]],template:function(t,n){t&1&&(s(0,"section",2)(1,"div",3)(2,"div",4),M(3,Qe,11,30,"div",5,qe,!1,Le,2,0,"div",6),a()(),s(6,"button",7),y("click",function(){return n.addEntry()}),c(7," Hinzuf\xFCgen "),a()()),t&2&&(o(3),I(n.history()))},dependencies:[$,Q,b],encapsulation:2})};var Y=class r{bottomSheet=C(Se);viewContainerRef=C(ce);weeklyCheckId=W.required();label=W.required();entry=W.required();shop=W.required();isOpened=x(!1);iconPath=g(()=>`assets/${this.shop()}.svg`);openBottomSheet(){this.isOpened.set(!0);let e={weeklyCheckId:this.weeklyCheckId(),shop:this.shop()};this.bottomSheet.open(R,{data:e,viewContainerRef:this.viewContainerRef}).afterDismissed().pipe(le(1),ae(()=>this.isOpened.set(!1))).subscribe()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-weekly-check-shop"]],inputs:{weeklyCheckId:[1,"weeklyCheckId"],label:[1,"label"],entry:[1,"entry"],shop:[1,"shop"]},decls:8,vars:9,consts:[[1,"flex","cursor-pointer","items-center","gap-2","rounded-lg","p-1","hover:bg-gray-600","focus:bg-gray-600",3,"click"],["alt","icon",1,"h-7","w-7","object-contain",3,"src"],[1,"flex","min-w-0","flex-col","gap-1"],[1,"text-xs"],[1,"text-sm"]],template:function(t,n){t&1&&(A(0,"div",0),ke("click",function(){return n.openBottomSheet()}),fe(1,"img",1),A(2,"div",2)(3,"span",3),c(4),G(),A(5,"span",4),c(6),k(7,"currency"),G()()()),t&2&&(f("bg-gray-600",n.isOpened())("bg-gray-700",!n.isOpened()),o(),ye("src",n.iconPath(),se),o(3),J(n.label()),o(2),J(_(7,7,n.entry().value)))},dependencies:[b],encapsulation:2})};var Ne=K(He());function Re(r,e){if(r&1&&V(0,"app-weekly-check-shop",13),r&2){let t=e.$implicit,n=u();f("*:bg-gray-600",n.isCurrent())("*:hover:bg-gray-500",n.isCurrent()),v("weeklyCheckId",n.week().id)("label",t.label)("entry",t.entry)("shop",t.shop)}}ie.default.extend(Ne.default);var F=class r{week=W.required();item=Ce.required(j);entries=g(()=>{let e=this.week();return[{label:"Lidl",entry:e.lidl,shop:"lidl"},{label:"Drogerie",entry:e.drugstore,shop:"drugstore"},{label:"Edeka",entry:e.edeka,shop:"edeka"},{label:"Sonstige",entry:e.misc,shop:"misc"},{label:"Kaufland",entry:e.kaufland,shop:"kaufland"},{label:"Ausw\xE4rts",entry:e.away,shop:"away"},{label:"B\xE4cker / Fleischer",entry:e.baker_butcher,shop:"baker_butcher"}]});isCurrent=g(()=>{let e=this.week(),t=(0,ie.default)().week();return e.cw===t});static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-week"]],viewQuery:function(t,n){t&1&&S(n.item,j,5),t&2&&D()},inputs:{week:[1,"week"]},decls:25,vars:29,consts:[["accItem","cdkAccordionItem"],[1,"cursor-pointer"],[3,"expanded"],[1,"grid","w-full","grid-cols-[5rem_1fr_1.5rem]","gap-2",3,"click"],[1,"flex","items-center","gap-4"],[1,"flex","flex-col","gap-2"],[1,"font-semibold"],[1,"text-(length:--text-xs)","font-medium"],[1,"text-right"],["size","small",1,"ml-1",3,"icon"],[1,"overflow-hidden","pt-4","transition-[max-height]","duration-300","ease-in-out"],[1,"grid","grid-cols-3","gap-2"],[3,"*:bg-gray-600","*:hover:bg-gray-500","weeklyCheckId","label","entry","shop"],[3,"weeklyCheckId","label","entry","shop"]],template:function(t,n){if(t&1){let i=E();s(0,"mat-card",1)(1,"mat-card-content")(2,"cdk-accordion-item",2,0)(4,"header",3),y("click",function(){d(i);let p=T(3);return m(p.toggle())}),s(5,"div",4)(6,"div",5)(7,"h2",6),c(8),a(),s(9,"h1",7),c(10),k(11,"date"),k(12,"date"),a()()(),s(13,"div",5)(14,"span",8),c(15),k(16,"currency"),a(),s(17,"span",8),c(18),k(19,"currency"),a()(),V(20,"app-icon",9),a(),s(21,"div",10)(22,"div",11),M(23,Re,1,8,"app-weekly-check-shop",12,ue),a()()()()()}if(t&2){let i=T(3);f("bg-gray-700!",n.isCurrent()),o(2),v("expanded",n.isCurrent()),o(6),h("KW ",n.week().cw),o(2),_e(" ",X(11,19,n.week().dateFrom,"dd.MM.")," - ",X(12,22,n.week().dateTo,"dd.MM.")," ");let l=n.week().total,p=250-l;o(4),f("text-green-500",l<=250)("text-red-500",l>250),o(),h(" ",_(16,25,l)," "),o(2),f("text-green-500",l<=250)("text-red-500",l>250),o(),h(" ",_(19,27,p)," "),o(2),v("icon",i.expanded?"ChevronUp":"ChevronDown"),o(),he("max-height",i.expanded?"1000px":"0px"),o(2),I(n.entries())}},dependencies:[be,xe,j,Ee,Y,we,b],encapsulation:2})};var z=K(ve());var Ye=(r,e)=>e.id;function ze(r,e){if(r&1&&c(0),r&2){let t=e.item,n=u();h(" ",n.format(t).format("MMMM")," ")}}function Ke(r,e){if(r&1){let t=E();s(0,"span",9),y("click",function(){d(t);let i=u();return m(i.expandAll())}),c(1," Alle ausklappen "),a()}}function Ue(r,e){if(r&1){let t=E();s(0,"span",9),y("click",function(){d(t);let i=u();return m(i.collapseAll())}),c(1," Alle einklappen "),a()}}function Ge(r,e){if(r&1&&V(0,"app-week",7),r&2){let t=e.$implicit;v("week",t)}}function Je(r,e){r&1&&c(0," Noch keine Wochen angelegt ")}var Ve=class r{facade=C(O);weeks=this.facade.weeklyChecks;isLoading=this.facade.isLoading;items=P(F);state=x("closed");currentMonth=g(()=>{let e=(0,z.default)().week();return this.weeks().find(t=>t.cw===e).month});filteredWeeks=g(()=>this.weeks().filter(e=>e.month===this.formModel().month));totalBudget=g(()=>this.filteredWeeks().length*250);totalSpent=g(()=>this.filteredWeeks().reduce((e,t)=>e+t.total,0));formModel=ge(()=>({month:this.currentMonth()}));form=q(this.formModel);x=0;constructor(){this.facade.loadWeeklyChecks()}expandAll(){this.items()?.forEach(e=>e.item().open()),this.state.set("open")}collapseAll(){this.items()?.forEach(e=>e.item().close()),this.state.set("closed")}createWeek(){this.facade.createWeek()}months=Array.from({length:12},(e,t)=>(0,z.default)().month(t).format("YYYY-MM-01"));format=z.default;static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-weekly-check"]],viewQuery:function(t,n){t&1&&S(n.items,F,5),t&2&&D()},hostAttrs:[1,"flex","flex-col"],decls:18,vars:17,consts:[["title","Wochencheck"],[1,"w-40",3,"items","clearable","formField"],["ng-label-tmp","","ng-option-tmp",""],[1,"container-max-sm","flex","items-center","justify-between","px-4","pt-2"],[1,"flex","items-center","gap-2"],[1,"cursor-pointer","text-sm"],[1,"container-max-sm","flex","w-full","flex-col","items-center","gap-2","p-2","*:w-full","md:p-6",3,"multi"],[3,"week"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"cursor-pointer","text-sm",3,"click"]],template:function(t,n){if(t&1&&(s(0,"app-header",0)(1,"ng-select",1),pe(2,ze,1,1,"ng-template",2),a(),H(),a(),s(3,"header",3)(4,"span",4),c(5),k(6,"currency"),s(7,"span"),c(8),k(9,"currency"),a()(),de(10,Ke,2,0,"span",5)(11,Ue,2,0,"span",5),a(),s(12,"cdk-accordion",6),M(13,Ge,1,1,"app-week",7,Ye,!1,Je,1,0),a(),s(16,"button",8),y("click",function(){return n.createWeek()}),c(17,` Neue Woche anlegen
`),a()),t&2){let i;o(),v("items",n.months)("clearable",!1),N(n.form.month,"formField"),o(4),h(" ",_(6,13,n.totalBudget())," | "),o(2),f("text-green-500",n.totalSpent()<=n.totalBudget())("text-red-500",n.totalSpent()>n.totalBudget()),o(),h(" ",_(9,15,n.totalSpent())," "),o(2),me((i=n.state())==="closed"?10:i==="open"?11:-1),o(2),v("multi",!0),o(),I(n.filteredWeeks())}},dependencies:[We,F,Me,Fe,Q,$,Te,De,b],encapsulation:2})};export{Ve as WeeklyCheckComponent};
