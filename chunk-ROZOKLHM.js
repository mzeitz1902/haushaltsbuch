import{a as $}from"./chunk-PSNP2WQ3.js";import{b as ze,c as Qe}from"./chunk-UDCF3VBL.js";import{a as qe}from"./chunk-QPHLC2XJ.js";import{a as He}from"./chunk-AEHS2M37.js";import{A as W,Aa as Ee,Ad as Ve,Ba as Me,Ca as We,Cd as Pe,Db as E,Ea as D,Eb as Be,Fa as I,Fb as j,Ga as C,Ha as l,I as be,Ia as c,Ja as T,K as ge,Ka as Y,La as re,M as oe,O as f,Pb as Fe,Q as d,Qa as x,R as p,Rb as w,S as ve,Sa as u,Ta as De,Td as je,Ua as y,Ud as z,V as Ce,Yd as Le,Z as v,Zd as Ye,_c as Oe,a as L,ab as B,b as ye,bb as F,be as $e,c as nt,cb as H,d as ie,db as Ie,ea as a,eb as h,ed as Re,ee as Q,fd as M,fe as K,gb as P,gd as le,ge as X,h as _e,hb as m,ib as ae,jb as b,ka as we,kb as Te,la as k,qa as xe,ra as Se,sb as _,tb as g,ua as O,ub as se,uc as Ae,v as ke,w as N,wc as Ne,ya as R,za as V,zb as S,zd as q}from"./chunk-ZDVCRLK2.js";var Ge=nt((pe,ue)=>{"use strict";(function(o,i){typeof pe=="object"&&typeof ue<"u"?ue.exports=i():typeof define=="function"&&define.amd?define(i):(o=typeof globalThis<"u"?globalThis:o||self).dayjs_plugin_weekOfYear=i()})(pe,function(){"use strict";var o="week",i="year";return function(e,t,n){var r=t.prototype;r.week=function(s){if(s===void 0&&(s=null),s!==null)return this.add(7*(s-this.week()),"day");var te=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var ne=n(this).startOf(i).add(1,i).date(te),et=n(this).endOf(o);if(ne.isBefore(et))return 1}var tt=n(this).startOf(i).date(te).startOf(o).subtract(1,"millisecond"),fe=this.diff(tt,o,!0);return fe<0?n(this).startOf("week").week():Math.ceil(fe)},r.weeks=function(s){return s===void 0&&(s=null),this.week(s)}}})});var he=ie(He());function ot(o,i){}var Ke="_mat-bottom-sheet-enter",Xe="_mat-bottom-sheet-exit",rt=(()=>{class o extends ze{_breakpointSubscription;_animationsDisabled=le();_animationState="void";_animationStateChanged=new Ce;_destroyed=!1;constructor(){super();let e=f(Oe);this._breakpointSubscription=e.observe([M.Medium,M.Large,M.XLarge]).subscribe(()=>{let t=this._elementRef.nativeElement.classList;t.toggle("mat-bottom-sheet-container-medium",e.isMatched(M.Medium)),t.toggle("mat-bottom-sheet-container-large",e.isMatched(M.Large)),t.toggle("mat-bottom-sheet-container-xlarge",e.isMatched(M.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._animationsDisabled&&this._simulateAnimation(Ke))}exit(){this._destroyed||(this._elementRef.nativeElement.setAttribute("mat-exit",""),this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._animationsDisabled&&this._simulateAnimation(Xe))}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_simulateAnimation(e){this._ngZone.run(()=>{this._handleAnimationEvent(!0,e),setTimeout(()=>this._handleAnimationEvent(!1,e))})}_trapFocus(){super._trapFocus({preventScroll:!0})}_handleAnimationEvent(e,t){let n=t===Ke;(n||t===Xe)&&this._animationStateChanged.emit({toState:n?"visible":"hidden",phase:e?"start":"done"})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=k({type:o,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:9,hostBindings:function(t,n){t&1&&u("animationstart",function(s){return n._handleAnimationEvent(!0,s.animationName)})("animationend",function(s){return n._handleAnimationEvent(!1,s.animationName)})("animationcancel",function(s){return n._handleAnimationEvent(!1,s.animationName)}),t&2&&(O("role",n._config.role)("aria-modal",n._config.ariaModal)("aria-label",n._config.ariaLabel),h("mat-bottom-sheet-container-animations-enabled",!n._animationsDisabled)("mat-bottom-sheet-container-enter",n._animationState==="visible")("mat-bottom-sheet-container-exit",n._animationState==="hidden"))},features:[xe],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,n){t&1&&Se(0,ot,0,0,"ng-template",0)},dependencies:[Le],styles:[`@keyframes _mat-bottom-sheet-enter{from{transform:translateY(100%)}to{transform:none}}@keyframes _mat-bottom-sheet-exit{from{transform:none}to{transform:translateY(100%)}}.mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;position:relative;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-animations-enabled{transform:translateY(100%)}.mat-bottom-sheet-container-animations-enabled.mat-bottom-sheet-container-enter{animation:_mat-bottom-sheet-enter 195ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-bottom-sheet-container-animations-enabled.mat-bottom-sheet-container-exit{animation:_mat-bottom-sheet-exit 375ms cubic-bezier(0.4, 0, 1, 1) backwards}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}
`],encapsulation:2})}return o})(),me=new oe("MatBottomSheetData"),ce=class{viewContainerRef;injector;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!1;closeOnNavigation=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},U=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new _e;_result;_closeFallbackTimeout;constructor(i,e,t){this._ref=i,this.containerInstance=t,this.disableClose=e.disableClose,t._animationStateChanged.pipe(N(n=>n.phase==="done"&&n.toState==="visible"),W(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe(N(n=>n.phase==="done"&&n.toState==="hidden"),W(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),i.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),ke(this.backdropClick(),this.keydownEvents().pipe(N(n=>n.keyCode===27))).subscribe(n=>{!this.disableClose&&(n.type!=="keydown"||!Re(n))&&(n.preventDefault(),this.dismiss())})}dismiss(i){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(N(e=>e.phase==="start"),W(1)).subscribe(()=>{this._closeFallbackTimeout=setTimeout(()=>this._ref.close(this._result),500),this._ref.overlayRef.detachBackdrop()}),this._result=i,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},at=new oe("mat-bottom-sheet-default-options"),Ue=(()=>{class o{_injector=f(ve);_parentBottomSheet=f(o,{optional:!0,skipSelf:!0});_animationsDisabled=le();_defaultOptions=f(at,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=f(Qe);get _openedBottomSheetRef(){let e=this._parentBottomSheet;return e?e._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(e){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=e:this._bottomSheetRefAtThisLevel=e}constructor(){}open(e,t){let n=L(L({},this._defaultOptions||new ce),t),r;return this._dialog.open(e,ye(L({},n),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:rt,scrollStrategy:n.scrollStrategy||Ye(this._injector),positionStrategy:$e(this._injector).centerHorizontally().bottom("0"),disableAnimations:this._animationsDisabled,templateContext:()=>({bottomSheetRef:r}),providers:(s,te,ne)=>(r=new U(s,n,ne),[{provide:U,useValue:r},{provide:me,useValue:n.data}])})),r.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===r&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>r.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):r.containerInstance.enter(),this._openedBottomSheetRef=r,r}dismiss(e){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(e)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ge({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var st=["noteInput"],lt=["valueInput"],ct=(o,i)=>i.id;function mt(o,i){if(o&1){let e=x();l(0,"div",8)(1,"span",9),u("click",function(){let n=d(e).$implicit,r=y();return p(r.edit(n,"note"))}),m(2),c(),l(3,"span",10),u("click",function(){let n=d(e).$implicit,r=y();return p(r.edit(n,"value"))}),m(4),_(5,"currency"),c(),l(6,"input",11,0),u("click",function(){d(e);let n=H(7);return p(n.select())})("blur",function(){d(e);let n=y();return p(n.submit())})("keyup.enter",function(){d(e);let n=y();return n.submit(),p(n.reset())}),c(),R(),l(8,"input",12,1),u("click",function(){d(e);let n=H(9);return p(n.select())})("blur",function(){d(e);let n=y();return p(n.submit())})("keyup.enter",function(){d(e);let n=y();return n.submit(),p(n.reset())}),c(),R(),l(10,"button",13),u("click",function(){let n=d(e).$implicit,r=y();return p(r.deleteEntry(n.id))}),c()()}if(o&2){let e=i.$implicit,t=i.$index,n=i.$count,r=y(),s="ml-2 my-2 p-4";h("border-b-gray-50",t!==n-1)("border-b",t!==n-1),a(),P(s),h("hidden",r.selectedEntry()===e.id),a(),b(" ",e.note," "),a(),P(s),h("hidden",r.selectedEntry()===e.id),a(),b(" ",g(5,28,e.value)," "),a(2),P(s),h("hidden",r.selectedEntry()!==e.id),O("data-id",e.id),V(r.form.note,"formField"),a(2),P(s),h("hidden",r.selectedEntry()!==e.id),O("data-id",e.id),V(r.form.value,"formField")}}function dt(o,i){o&1&&(l(0,"div",6),m(1,"Noch keine Eintr\xE4ge vorhanden."),c())}var Z=class o{facade=f($);history=this.facade.currentHistory;data=f(me);noteInputs=j("noteInput");valueInputs=j("valueInput");selectedEntry=v(null);formModel=v(this.initForm());form=Q(this.formModel,i=>{X(i.id),X(i.value),X(i.note)});constructor(){this.facade.setCurrentHistoryInformation(this.data.weeklyCheckId,this.data.shop)}deleteEntry(i){return this.facade.deleteHistoryEntry(i)}addEntry(){this.facade.addHistoryEntry()}edit(i,e){this.selectedEntry.set(i.id),this.formModel.set({id:i.id,value:i.value,note:i.note}),setTimeout(()=>{let t=this.selectedEntry();if(t)switch(e){case"note":{this.noteInputs().find(r=>r.nativeElement.dataset.id===t).nativeElement.select();break}case"value":{this.valueInputs().find(r=>r.nativeElement.dataset.id===t).nativeElement.select();break}}})}submit(){this.form().valid()&&this.facade.updateHistoryEntry(this.formModel())}reset(){this.selectedEntry.set(null),this.formModel.set(this.initForm())}initForm(){return{id:null,value:null,note:null}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-weekly-history"]],viewQuery:function(e,t){e&1&&B(t.noteInputs,st,5)(t.valueInputs,lt,5),e&2&&F(2)},decls:8,vars:1,consts:[["noteInput",""],["valueInput",""],[1,"flex","flex-col","gap-2","overflow-hidden","pb-2"],[1,"max-h-64","overflow-auto"],[1,"flex","w-full","flex-col","items-center","justify-center","**:text-white"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2",3,"border-b-gray-50","border-b"],[1,"p-2"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2"],[3,"click"],[1,"m-0!","my-0!","w-full","text-right",3,"click"],[1,"w-full","rounded","border","border-blue-400","bg-gray-600","outline-none",3,"click","blur","keyup.enter","formField"],["type","number",1,"w-full","rounded","border","border-blue-400","bg-gray-600","text-right","outline-none",3,"click","blur","keyup.enter","formField"],["maffiButton","","icon","Trash",1,"mr-2",3,"click"]],template:function(e,t){e&1&&(l(0,"section",2)(1,"div",3)(2,"div",4),D(3,mt,11,30,"div",5,ct,!1,dt,2,0,"div",6),c()(),l(6,"button",7),u("click",function(){return t.addEntry()}),m(7," Hinzuf\xFCgen "),c()()),e&2&&(a(3),I(t.history()))},dependencies:[q,K,w],encapsulation:2})};var J=class o{bottomSheet=f(Ue);viewContainerRef=f(we);weeklyCheckId=E.required();label=E.required();entry=E.required();shop=E.required();isOpened=v(!1);openBottomSheet(){this.isOpened.set(!0);let i={weeklyCheckId:this.weeklyCheckId(),shop:this.shop()};this.bottomSheet.open(Z,{data:i,viewContainerRef:this.viewContainerRef}).afterDismissed().pipe(W(1),be(()=>this.isOpened.set(!1))).subscribe()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-weekly-check-shop"]],inputs:{weeklyCheckId:[1,"weeklyCheckId"],label:[1,"label"],entry:[1,"entry"],shop:[1,"shop"]},decls:6,vars:8,consts:[[1,"flex","cursor-pointer","flex-col","gap-1","rounded-lg","p-1","hover:bg-gray-600","focus:bg-gray-600",3,"click"],[1,"text-xs","whitespace-nowrap"],[1,"text-sm"]],template:function(e,t){e&1&&(Y(0,"div",0),De("click",function(){return t.openBottomSheet()}),Y(1,"span",1),m(2),re(),Y(3,"span",2),m(4),_(5,"currency"),re()()),e&2&&(h("bg-gray-600",t.isOpened())("bg-gray-700",!t.isOpened()),a(2),ae(t.label()),a(2),ae(g(5,6,t.entry().value)))},dependencies:[w],encapsulation:2})};var Ze=ie(Ge());function pt(o,i){if(o&1&&T(0,"app-weekly-check-shop",11),o&2){let e=i.$implicit,t=y();C("weeklyCheckId",t.week().id)("label",e.label)("entry",e.entry)("shop",e.shop)}}he.default.extend(Ze.default);var A=class o{week=E.required();item=Be.required(z);entries=S(()=>{let i=this.week();return[{label:"Lidl",entry:i.lidl,shop:"lidl"},{label:"Drogerie",entry:i.drugstore,shop:"drugstore"},{label:"Edeka",entry:i.edeka,shop:"edeka"},{label:"Sonstige",entry:i.misc,shop:"misc"},{label:"Kaufland",entry:i.kaufland,shop:"kaufland"},{label:"B\xE4cker / Fleischer",entry:i.baker_butcher,shop:"baker_butcher"},{label:"Ausw\xE4rts",entry:i.away,shop:"away"}]});isExpanded=S(()=>{let i=this.week(),e=(0,he.default)().week();return i.cw===e});static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-week"]],viewQuery:function(e,t){e&1&&B(t.item,z,5),e&2&&F()},inputs:{week:[1,"week"]},decls:25,vars:27,consts:[["accItem","cdkAccordionItem"],[3,"expanded"],[1,"grid","w-full","grid-cols-[5rem_1fr_1.5rem]","gap-2",3,"click"],[1,"flex","items-center","gap-4"],[1,"flex","flex-col","gap-2"],[1,"font-semibold"],[1,"text-(length:--text-xs)","font-medium"],[1,"text-right"],["size","small",1,"ml-1",3,"icon"],[1,"overflow-hidden","pt-4","transition-[max-height]","duration-300","ease-in-out"],[1,"grid","grid-cols-3","gap-2"],[3,"weeklyCheckId","label","entry","shop"]],template:function(e,t){if(e&1){let n=x();l(0,"mat-card")(1,"mat-card-content")(2,"cdk-accordion-item",1,0)(4,"header",2),u("click",function(){d(n);let s=H(3);return p(s.toggle())}),l(5,"div",3)(6,"div",4)(7,"h2",5),m(8),c(),l(9,"h1",6),m(10),_(11,"date"),_(12,"date"),c()()(),l(13,"div",4)(14,"span",7),m(15),_(16,"currency"),c(),l(17,"span",7),m(18),_(19,"currency"),c()(),T(20,"app-icon",8),c(),l(21,"div",9)(22,"div",10),D(23,pt,1,4,"app-weekly-check-shop",11,We),c()()()()()}if(e&2){let n=H(3);a(2),C("expanded",t.isExpanded()),a(6),b("KW ",t.week().cw),a(2),Te(" ",se(11,17,t.week().dateFrom,"dd.MM.")," - ",se(12,20,t.week().dateTo,"dd.MM.")," ");let r=t.week().total,s=250-r;a(4),h("text-green-500",r<=250)("text-red-500",r>250),a(),b(" ",g(16,23,r)," "),a(2),h("text-green-500",r<=250)("text-red-500",r>250),a(),b(" ",g(19,25,s)," "),a(2),C("icon",n.expanded?"ChevronUp":"ChevronDown"),a(),Ie("max-height",n.expanded?"1000px":"0px"),a(2),I(t.entries())}},dependencies:[Ae,Ne,z,Ve,J,Fe,w],encapsulation:2})};var ee=ie(He());var ut=(o,i)=>i.id;function ht(o,i){if(o&1){let e=x();l(0,"span",8),u("click",function(){d(e);let n=y();return p(n.expandAll())}),m(1," Alle ausklappen "),c()}}function ft(o,i){if(o&1){let e=x();l(0,"span",8),u("click",function(){d(e);let n=y();return p(n.collapseAll())}),m(1," Alle einklappen "),c()}}function yt(o,i){if(o&1&&T(0,"app-week",6),o&2){let e=i.$implicit;C("week",e)}}function _t(o,i){o&1&&m(0," Noch keine Wochen angelegt ")}var Je=class o{facade=f($);weeks=this.facade.weeklyChecks;isLoading=this.facade.isLoading;items=j(A);state=v("closed");formModel=v({month:{label:(0,ee.default)().format("MMMM"),value:(0,ee.default)().format("YYYY-MM-01")}});form=Q(this.formModel);filteredWeeks=S(()=>this.weeks().filter(i=>i.month===this.formModel().month.value));totalBudget=S(()=>this.filteredWeeks().length*250);totalSpent=S(()=>this.filteredWeeks().reduce((i,e)=>i+e.total,0));constructor(){this.facade.loadWeeklyChecks()}compareWith(i,e){return i?.value===e?.value}expandAll(){this.items()?.forEach(i=>i.item().open()),this.state.set("open")}collapseAll(){this.items()?.forEach(i=>i.item().close()),this.state.set("closed")}createWeek(){this.facade.createWeek()}months=Array.from({length:12},(i,e)=>{let t=(0,ee.default)().month(e);return{label:t.format("MMMM"),value:t.format("YYYY-MM-01")}});static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-weekly-check"]],viewQuery:function(e,t){e&1&&B(t.items,A,5),e&2&&F()},hostAttrs:[1,"flex","flex-col"],decls:17,vars:18,consts:[["title","Wochencheck"],["bindLabel","label","bindValue","value",1,"w-40",3,"items","clearable","formField","compareWith"],[1,"flex","items-center","justify-between","px-4","pt-2"],[1,"flex","items-center","gap-2"],[1,"cursor-pointer","text-sm"],[1,"container-max-sm","flex","w-full","flex-col","items-center","gap-2","p-2","*:w-full","md:p-6",3,"multi"],[3,"week"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"cursor-pointer","text-sm",3,"click"]],template:function(e,t){if(e&1&&(l(0,"app-header",0),T(1,"ng-select",1),R(),c(),l(2,"header",2)(3,"span",3),m(4),_(5,"currency"),l(6,"span"),m(7),_(8,"currency"),c()(),Ee(9,ht,2,0,"span",4)(10,ft,2,0,"span",4),c(),l(11,"cdk-accordion",5),D(12,yt,1,1,"app-week",6,ut,!1,_t,1,0),c(),l(15,"button",7),u("click",function(){return t.createWeek()}),m(16,` Neue Woche anlegen
`),c()),e&2){let n;a(),C("items",t.months)("clearable",!1)("compareWith",t.compareWith),V(t.form.month,"formField"),a(3),b(" ",g(5,14,t.totalBudget())," | "),a(2),h("text-green-500",t.totalSpent()<=t.totalBudget())("text-red-500",t.totalSpent()>t.totalBudget()),a(),b(" ",g(8,16,t.totalSpent())," "),a(2),Me((n=t.state())==="closed"?9:n==="open"?10:-1),a(2),C("multi",!0),a(),I(t.filteredWeeks())}},dependencies:[Pe,A,je,qe,K,q,w],encapsulation:2})};export{Je as WeeklyCheckComponent};
