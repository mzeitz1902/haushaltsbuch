import{a as A}from"./chunk-LESVENOT.js";import{a as xe,b as We,c as Ee}from"./chunk-W2XRMML6.js";import{$a as F,A as re,Aa as pe,Ab as M,Ad as $,Bb as ue,Ca as I,Cb as P,Da as S,Dd as j,Ea as _,Ed as q,Fa as l,Fd as Y,Ga as a,Ha as W,I as oe,Mb as fe,O as v,Oa as E,Ob as x,Q as d,Qa as u,Qb as ye,Qd as we,R as m,Ra as f,Rd as be,Z as w,Za as D,_a as T,ab as de,bb as y,c as He,d as z,db as B,ea as o,eb as c,fb as U,gb as h,hb as me,ja as le,ka as b,pb as k,qa as ae,qb as g,qc as ke,rb as G,ta as K,vc as he,vd as O,wa as N,wb as C,wd as ge,xa as V,xc as _e,ya as se,yd as Ce,za as ce,zd as ve}from"./chunk-OEICJO6R.js";var Me=He((Z,ee)=>{"use strict";(function(r,e){typeof Z=="object"&&typeof ee<"u"?ee.exports=e():typeof define=="function"&&define.amd?define(e):(r=typeof globalThis<"u"?globalThis:r||self).dayjs_plugin_weekOfYear=e()})(Z,function(){"use strict";var r="week",e="year";return function(t,n,i){var s=n.prototype;s.week=function(p){if(p===void 0&&(p=null),p!==null)return this.add(7*(p-this.week()),"day");var ne=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var De=i(this).startOf(e).add(1,e).date(ne),Te=i(this).endOf(r);if(De.isBefore(Te))return 1}var Fe=i(this).startOf(e).date(ne).startOf(r).subtract(1,"millisecond"),ie=this.diff(Fe,r,!0);return ie<0?i(this).startOf("week").week():Math.ceil(ie)},s.weeks=function(p){return p===void 0&&(p=null),this.week(p)}}})});var te=z(ke());var Ne=["noteInput"],Ve=["valueInput"],Be=(r,e)=>e.id;function Pe(r,e){if(r&1){let t=E();l(0,"div",8)(1,"span",9),u("click",function(){let i=d(t).$implicit,s=f();return m(s.edit(i,"note"))}),c(2),a(),l(3,"span",10),u("click",function(){let i=d(t).$implicit,s=f();return m(s.edit(i,"value"))}),c(4),k(5,"currency"),a(),l(6,"input",11,0),u("click",function(){d(t);let i=F(7);return m(i.select())})("blur",function(){d(t);let i=f();return m(i.submit())})("keyup.enter",function(){d(t);let i=f();return i.submit(),m(i.reset())}),a(),N(),l(8,"input",12,1),u("click",function(){d(t);let i=F(9);return m(i.select())})("blur",function(){d(t);let i=f();return m(i.submit())})("keyup.enter",function(){d(t);let i=f();return i.submit(),m(i.reset())}),a(),N(),l(10,"button",13),u("click",function(){let i=d(t).$implicit,s=f();return m(s.deleteEntry(i.id))}),a()()}if(r&2){let t=e.$implicit,n=e.$index,i=e.$count,s=f(),p="ml-2 my-2 p-4";y("border-b-gray-50",n!==i-1)("border-b",n!==i-1),o(),B(p),y("hidden",s.selectedEntry()===t.id),o(),h(" ",t.note," "),o(),B(p),y("hidden",s.selectedEntry()===t.id),o(),h(" ",g(5,28,t.value)," "),o(2),B(p),y("hidden",s.selectedEntry()!==t.id),K("data-id",t.id),V(s.form.note,"formField"),o(2),B(p),y("hidden",s.selectedEntry()!==t.id),K("data-id",t.id),V(s.form.value,"formField")}}function Ae(r,e){r&1&&(l(0,"div",6),c(1,"Noch keine Eintr\xE4ge vorhanden."),a())}var Q=class r{facade=v(A);history=this.facade.currentHistory;data=v(we);noteInputs=P("noteInput");valueInputs=P("valueInput");selectedEntry=w(null);formModel=w(this.initForm());form=j(this.formModel,e=>{Y(e.id),Y(e.value),Y(e.note)});constructor(){this.facade.setCurrentHistoryInformation(this.data.weeklyCheckId,this.data.shop)}deleteEntry(e){return this.facade.deleteHistoryEntry(e)}addEntry(){this.facade.addHistoryEntry()}edit(e,t){this.selectedEntry.set(e.id),this.formModel.set({id:e.id,value:e.value,note:e.note}),setTimeout(()=>{let n=this.selectedEntry();if(n)switch(t){case"note":{this.noteInputs().find(s=>s.nativeElement.dataset.id===n).nativeElement.select();break}case"value":{this.valueInputs().find(s=>s.nativeElement.dataset.id===n).nativeElement.select();break}}})}submit(){this.form().valid()&&this.facade.updateHistoryEntry(this.formModel())}reset(){this.selectedEntry.set(null),this.formModel.set(this.initForm())}initForm(){return{id:null,value:null,note:null}}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-weekly-history"]],viewQuery:function(t,n){t&1&&D(n.noteInputs,Ne,5)(n.valueInputs,Ve,5),t&2&&T(2)},decls:8,vars:1,consts:[["noteInput",""],["valueInput",""],[1,"flex","flex-col","gap-2","overflow-hidden","pb-2"],[1,"max-h-64","overflow-auto"],[1,"flex","w-full","flex-col","items-center","justify-center","**:text-white"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2",3,"border-b-gray-50","border-b"],[1,"p-2"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"grid","w-full","grid-cols-[auto_6rem_min-content]","items-center","gap-2"],[3,"click"],[1,"m-0!","my-0!","w-full","text-right",3,"click"],[1,"w-full","rounded","border","border-blue-400","bg-gray-600","outline-none",3,"click","blur","keyup.enter","formField"],["type","number",1,"w-full","rounded","border","border-blue-400","bg-gray-600","text-right","outline-none",3,"click","blur","keyup.enter","formField"],["maffiButton","","icon","Trash",1,"mr-2",3,"click"]],template:function(t,n){t&1&&(l(0,"section",2)(1,"div",3)(2,"div",4),I(3,Pe,11,30,"div",5,Be,!1,Ae,2,0,"div",6),a()(),l(6,"button",7),u("click",function(){return n.addEntry()}),c(7," Hinzuf\xFCgen "),a()()),t&2&&(o(3),S(n.history()))},dependencies:[O,q,x],encapsulation:2})};var R=class r{bottomSheet=v(be);viewContainerRef=v(le);weeklyCheckId=M.required();label=M.required();entry=M.required();shop=M.required();isOpened=w(!1);iconPath=C(()=>`assets/${this.shop()}.svg`);openBottomSheet(){this.isOpened.set(!0);let e={weeklyCheckId:this.weeklyCheckId(),shop:this.shop()};this.bottomSheet.open(Q,{data:e,viewContainerRef:this.viewContainerRef}).afterDismissed().pipe(re(1),oe(()=>this.isOpened.set(!1))).subscribe()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-weekly-check-shop"]],inputs:{weeklyCheckId:[1,"weeklyCheckId"],label:[1,"label"],entry:[1,"entry"],shop:[1,"shop"]},decls:8,vars:9,consts:[[1,"flex","cursor-pointer","items-center","gap-2","rounded-lg","p-1","hover:bg-gray-600","focus:bg-gray-600",3,"click"],["alt","icon",1,"h-7","w-7","object-contain",3,"ngSrc"],[1,"flex","min-w-0","flex-col","gap-1"],[1,"text-xs"],[1,"text-sm"]],template:function(t,n){t&1&&(l(0,"div",0),u("click",function(){return n.openBottomSheet()}),W(1,"img",1),l(2,"div",2)(3,"span",3),c(4),a(),l(5,"span",4),c(6),k(7,"currency"),a()()()),t&2&&(y("bg-gray-600",n.isOpened())("bg-gray-700",!n.isOpened()),o(),_("ngSrc",n.iconPath()),o(3),U(n.label()),o(2),U(g(7,7,n.entry().value)))},dependencies:[ye,x],encapsulation:2})};var Ie=z(Me());function Oe(r,e){if(r&1&&W(0,"app-weekly-check-shop",13),r&2){let t=e.$implicit,n=f();y("*:bg-gray-600",n.isCurrent())("*:hover:bg-gray-500",n.isCurrent()),_("weeklyCheckId",n.week().id)("label",t.label)("entry",t.entry)("shop",t.shop)}}te.default.extend(Ie.default);var H=class r{week=M.required();item=ue.required($);entries=C(()=>{let e=this.week();return[{label:"Lidl",entry:e.lidl,shop:"lidl"},{label:"Drogerie",entry:e.drugstore,shop:"drugstore"},{label:"Edeka",entry:e.edeka,shop:"edeka"},{label:"Sonstige",entry:e.misc,shop:"misc"},{label:"Kaufland",entry:e.kaufland,shop:"kaufland"},{label:"Ausw\xE4rts",entry:e.away,shop:"away"},{label:"B\xE4cker / Fleischer",entry:e.baker_butcher,shop:"baker_butcher"}]});isCurrent=C(()=>{let e=this.week(),t=(0,te.default)().week();return e.cw===t});static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-week"]],viewQuery:function(t,n){t&1&&D(n.item,$,5),t&2&&T()},inputs:{week:[1,"week"]},decls:25,vars:29,consts:[["accItem","cdkAccordionItem"],[1,"cursor-pointer"],[3,"expanded"],[1,"grid","w-full","grid-cols-[5rem_1fr_1.5rem]","gap-2",3,"click"],[1,"flex","items-center","gap-4"],[1,"flex","flex-col","gap-2"],[1,"font-semibold"],[1,"text-(length:--text-xs)","font-medium"],[1,"text-right"],["size","small",1,"ml-1",3,"icon"],[1,"overflow-hidden","pt-4","transition-[max-height]","duration-300","ease-in-out"],[1,"grid","grid-cols-3","gap-2"],[3,"*:bg-gray-600","*:hover:bg-gray-500","weeklyCheckId","label","entry","shop"],[3,"weeklyCheckId","label","entry","shop"]],template:function(t,n){if(t&1){let i=E();l(0,"mat-card",1)(1,"mat-card-content")(2,"cdk-accordion-item",2,0)(4,"header",3),u("click",function(){d(i);let p=F(3);return m(p.toggle())}),l(5,"div",4)(6,"div",5)(7,"h2",6),c(8),a(),l(9,"h1",7),c(10),k(11,"date"),k(12,"date"),a()()(),l(13,"div",5)(14,"span",8),c(15),k(16,"currency"),a(),l(17,"span",8),c(18),k(19,"currency"),a()(),W(20,"app-icon",9),a(),l(21,"div",10)(22,"div",11),I(23,Oe,1,8,"app-weekly-check-shop",12,pe),a()()()()()}if(t&2){let i=F(3);y("bg-gray-700!",n.isCurrent()),o(2),_("expanded",n.isCurrent()),o(6),h("KW ",n.week().cw),o(2),me(" ",G(11,19,n.week().dateFrom,"dd.MM.")," - ",G(12,22,n.week().dateTo,"dd.MM.")," ");let s=n.week().total,p=250-s;o(4),y("text-green-500",s<=250)("text-red-500",s>250),o(),h(" ",g(16,25,s)," "),o(2),y("text-green-500",s<=250)("text-red-500",s>250),o(),h(" ",g(19,27,p)," "),o(2),_("icon",i.expanded?"ChevronUp":"ChevronDown"),o(),de("max-height",i.expanded?"1000px":"0px"),o(2),S(n.entries())}},dependencies:[he,_e,$,ge,R,fe,x],encapsulation:2})};var L=z(ke());var $e=(r,e)=>e.id;function je(r,e){if(r&1&&c(0),r&2){let t=e.item,n=f();h(" ",n.format(t).format("MMMM")," ")}}function qe(r,e){if(r&1){let t=E();l(0,"span",9),u("click",function(){d(t);let i=f();return m(i.expandAll())}),c(1," Alle ausklappen "),a()}}function Ye(r,e){if(r&1){let t=E();l(0,"span",9),u("click",function(){d(t);let i=f();return m(i.collapseAll())}),c(1," Alle einklappen "),a()}}function Qe(r,e){if(r&1&&W(0,"app-week",7),r&2){let t=e.$implicit;_("week",t)}}function Re(r,e){r&1&&c(0," Noch keine Wochen angelegt ")}var Se=class r{facade=v(A);weeks=this.facade.weeklyChecks;isLoading=this.facade.isLoading;items=P(H);state=w("closed");formModel=w({month:(0,L.default)().format("YYYY-MM-01")});form=j(this.formModel);filteredWeeks=C(()=>this.weeks().filter(e=>e.month===this.formModel().month));totalBudget=C(()=>this.filteredWeeks().length*250);totalSpent=C(()=>this.filteredWeeks().reduce((e,t)=>e+t.total,0));constructor(){this.facade.loadWeeklyChecks()}expandAll(){this.items()?.forEach(e=>e.item().open()),this.state.set("open")}collapseAll(){this.items()?.forEach(e=>e.item().close()),this.state.set("closed")}createWeek(){this.facade.createWeek()}months=Array.from({length:12},(e,t)=>(0,L.default)().month(t).format("YYYY-MM-01"));format=L.default;static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-weekly-check"]],viewQuery:function(t,n){t&1&&D(n.items,H,5),t&2&&T()},hostAttrs:[1,"flex","flex-col"],decls:18,vars:17,consts:[["title","Wochencheck"],[1,"w-40",3,"items","clearable","formField"],["ng-label-tmp","","ng-option-tmp",""],[1,"container-max-sm","flex","items-center","justify-between","px-4","pt-2"],[1,"flex","items-center","gap-2"],[1,"cursor-pointer","text-sm"],[1,"container-max-sm","flex","w-full","flex-col","items-center","gap-2","p-2","*:w-full","md:p-6",3,"multi"],[3,"week"],["maffiButton","","icon","CirclePlus",1,"self-center",3,"click"],[1,"cursor-pointer","text-sm",3,"click"]],template:function(t,n){if(t&1&&(l(0,"app-header",0)(1,"ng-select",1),ae(2,je,1,1,"ng-template",2),a(),N(),a(),l(3,"header",3)(4,"span",4),c(5),k(6,"currency"),l(7,"span"),c(8),k(9,"currency"),a()(),se(10,qe,2,0,"span",5)(11,Ye,2,0,"span",5),a(),l(12,"cdk-accordion",6),I(13,Qe,1,1,"app-week",7,$e,!1,Re,1,0),a(),l(16,"button",8),u("click",function(){return n.createWeek()}),c(17,` Neue Woche anlegen
`),a()),t&2){let i;o(),_("items",n.months)("clearable",!1),V(n.form.month,"formField"),o(4),h(" ",g(6,13,n.totalBudget())," | "),o(2),y("text-green-500",n.totalSpent()<=n.totalBudget())("text-red-500",n.totalSpent()>n.totalBudget()),o(),h(" ",g(9,15,n.totalSpent())," "),o(2),ce((i=n.state())==="closed"?10:i==="open"?11:-1),o(2),_("multi",!0),o(),S(n.filteredWeeks())}},dependencies:[Ce,H,ve,Ee,q,O,We,xe,x],encapsulation:2})};export{Se as WeeklyCheckComponent};
