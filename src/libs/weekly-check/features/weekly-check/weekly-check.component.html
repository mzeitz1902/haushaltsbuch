<app-header title="Wochencheck">
  <ng-select
    class="w-40"
    [items]="months"
    [clearable]="false"
    [formField]="form.month"
  >
    <ng-template ng-label-tmp ng-option-tmp let-item="item">
      {{ format(item).format('MMMM') }}
    </ng-template>
  </ng-select>
</app-header>

<header class="container-max-sm flex items-center justify-between px-4 pt-2">
  <span class="flex items-center gap-2">
    {{ totalBudget() | currency }}
    |
    <span
      [class.text-green-500]="totalSpent() <= totalBudget()"
      [class.text-red-500]="totalSpent() > totalBudget()"
    >
      {{ totalSpent() | currency }}
    </span>
  </span>
  @switch (state()) {
    @case ('closed') {
      <span class="cursor-pointer text-sm" (click)="expandAll()">
        Alle ausklappen
      </span>
    }
    @case ('open') {
      <span class="cursor-pointer text-sm" (click)="collapseAll()">
        Alle einklappen
      </span>
    }
  }
</header>

<cdk-accordion
  class="container-max-sm flex w-full flex-col items-center gap-2 p-2 *:w-full md:p-6"
  [multi]="true"
>
  @for (week of filteredWeeks(); track week.id) {
    <app-week [week]="week" />
  } @empty {
    Noch keine Wochen angelegt
  }
</cdk-accordion>

<button
  maffiButton
  class="self-center"
  icon="CirclePlus"
  (click)="createWeek()"
>
  Neue Woche anlegen
</button>
