<mat-card>
  <mat-card-content>
    <cdk-accordion-item
      #accItem="cdkAccordionItem"
      class="flex flex-col"
      [class.gap-3]="accItem.expanded"
    >
      @if (headerTitle()) {
        <header
          class="sticky top-14 z-10 grid w-full grid-cols-[min-content_3rem_1fr_1rem] items-center gap-2 overflow-hidden bg-gray-800 py-2 backdrop-blur transition-all duration-100 md:top-16"
          (click)="accItem.toggle()"
        >
          <app-icon [icon]="headerIcon()" size="medium" #col1 />
          <div #col2Title class="flex items-center gap-2">
            <h2 class="w-min text-sm font-semibold text-gray-100">
              {{ headerTitle() }}
            </h2>
            @if (isSaving()) {
              <mat-spinner diameter="18" />
            }
          </div>
          <h1
            #col3Value
            class="text-right text-(length:--text-xs) leading-(--text-sm--line-height) font-medium"
          >
            @if (!accItem.expanded) {
              {{ total() | currency }}
            }
          </h1>
          <app-icon
            #col4
            [icon]="accItem.expanded ? 'ChevronUp' : 'ChevronDown'"
            size="small"
            class="ml-1"
          />
        </header>

        <app-money-table-content
          [isExpanded]="accItem.expanded"
          [data]="data()"
          [isLoading]="isLoading()"
          [isSaving]="isSaving()"
          [isAdded]="isAdded()"
          [total]="total()"
          [hasSum]="hasSum()"
          [col3Template]="col3Template()"
          [useDataTemplate]="useDataTemplate()"
          [valuesWithHistoryKind]="valuesWithHistoryKind()"
          (updateRow)="updateRow.emit($event)"
          (deleteRow)="deleteRow.emit($event)"
          (addRow)="addRow.emit()"
        />
      }
    </cdk-accordion-item>
  </mat-card-content>
</mat-card>
