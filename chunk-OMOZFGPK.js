import{G as p,K as h,O as l,bc as C,cc as v,dc as w,ec as m,f as W,gc as _,ic as b,jc as I,kc as g,lc as x,m as a,mc as F,nc as P,oc as k,pc as d,r as u,zb as E}from"./chunk-ZDVCRLK2.js";var i=b({source:"Weekly Check",events:{load:void 0,loadSuccess:void 0,setCurrentHistoryInformation:void 0,addHistoryEntry:void 0,addHistoryEntrySuccess:void 0,deleteHistoryEntry:void 0,deleteHistoryEntrySuccess:void 0,updateHistoryEntry:void 0,updateHistoryEntrySuccess:void 0}}),r={load:i.load,loadSuccess:i.loadSuccess,setCurrentHistoryInformation:i.setCurrentHistoryInformation,addHistoryEntry:i.addHistoryEntry,addHistoryEntrySuccess:i.addHistoryEntrySuccess,deleteHistoryEntry:i.deleteHistoryEntry,deleteHistoryEntrySuccess:i.deleteHistoryEntrySuccess,updateHistoryEntry:i.updateHistoryEntry,updateHistoryEntrySuccess:i.updateHistoryEntrySuccess};var c=class o{getWeeklyChecks(){return a(k.from("weekly_check").select("*").order("id")).pipe(u(e=>e.data??null))}addHistoryEntry(e,t){return a(k.rpc("append_weekly_check_history",{p_weekly_check_id:e,p_shop_column:t}))}deleteHistoryEntry(e,t,y){return a(k.rpc("delete_weekly_check_history",{p_history_id:t,p_shop:y,p_weekly_check_id:e}))}updateHistoryEntry(e,t,{id:y,value:s,note:n}){return a(k.rpc("update_weekly_check_history",{p_weekly_check_id:e,p_shop:t,p_history_id:y,p_new_value:s,p_new_note:n}))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=h({token:o,factory:o.\u0275fac})};function j(o,e=l(_),t=l(c)){function y(){return W(u(s=>{let n=C(o);return{weeklyCheckId:n.currentWeekId,shop:n.currentShop,payload:s.payload}}))}return{load$:e.on(r.load,r.addHistoryEntrySuccess,r.deleteHistoryEntrySuccess,r.updateHistoryEntrySuccess).pipe(p(()=>t.getWeeklyChecks().pipe(d({next:s=>r.loadSuccess(s),error:console.error})))),addHistoryEntry$:e.on(r.addHistoryEntry).pipe(y(),p(({weeklyCheckId:s,shop:n})=>t.addHistoryEntry(s,n).pipe(d({next:()=>r.addHistoryEntrySuccess(),error:console.error})))),deleteHistoryEntry$:e.on(r.deleteHistoryEntry).pipe(y(),p(({weeklyCheckId:s,shop:n,payload:H})=>t.deleteHistoryEntry(s,H,n).pipe(d({next:()=>r.deleteHistoryEntrySuccess(),error:console.error})))),updateHistoryEntry$:e.on(r.updateHistoryEntry).pipe(y(),p(({weeklyCheckId:s,shop:n,payload:H})=>t.updateHistoryEntry(s,n,H).pipe(d({next:()=>r.updateHistoryEntrySuccess(),error:console.error}))))}}var f=v(F("weekly-check",x()),w({weeklyChecks:[],loadProcessStatus:"init",currentWeekId:null,currentShop:null}),g(o=>j(o)),P(m(r.load,()=>({loadProcessStatus:"pending"})),m(r.loadSuccess,({payload:o},e)=>o?{weeklyChecks:o,loadProcessStatus:"success"}:e),m(r.setCurrentHistoryInformation,({payload:{weeklyCheckId:o,shop:e}})=>({currentWeekId:o,currentShop:e}))));var S=class o{events=I(r);store=l(f);loadProcessStatus=this.store.loadProcessStatus;weeklyChecks=this.store.weeklyChecks;currentWeekId=this.store.currentWeekId;currentShop=this.store.currentShop;isLoading=E(()=>this.loadProcessStatus()==="pending");currentHistory=E(()=>{let e=this.weeklyChecks().find(t=>t.id===this.currentWeekId());return!e||!this.currentShop()?null:e[this.currentShop()].history});loadWeeklyChecks(){this.events.load()}setCurrentHistoryInformation(e,t){this.events.setCurrentHistoryInformation({weeklyCheckId:e,shop:t})}addHistoryEntry(){this.events.addHistoryEntry()}deleteHistoryEntry(e){return this.events.deleteHistoryEntry(e)}updateHistoryEntry(e){this.events.updateHistoryEntry(e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=h({token:o,factory:o.\u0275fac})};function de(){return[c,S,f]}export{S as a,de as b};
